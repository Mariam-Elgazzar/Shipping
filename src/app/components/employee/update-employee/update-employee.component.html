<div class="update-employee-container">
  <div class="card">
    <div class="card-content">
      <div class="header-actions">
        <h1>Update Employee</h1>
      </div>

      <div *ngIf="loadingData" class="loading-container">
        <div class="spinner-large"></div>
        <p>Loading employee data...</p>
      </div>

      <form *ngIf="!loadingData" [formGroup]="employeeForm" (ngSubmit)="onSubmit()">
        <!-- Employee Name -->
        <div class="form-row">
          <div class="form-group">
            <label for="employee-name">Employee Name <span class="required">*</span></label>
            <input
              type="text"
              id="employee-name"
              formControlName="name"
              placeholder="Enter employee name"
              [ngClass]="{'is-invalid': nameControl?.invalid && nameControl?.touched}"
            >
            <div class="error-message" *ngIf="nameControl?.invalid && nameControl?.touched">
              <span *ngIf="nameControl?.errors?.['required']">Employee name is required</span>
              <span *ngIf="nameControl?.errors?.['pattern']">Enter a valid name</span>
              <span *ngIf="nameControl?.errors?.['minlength']">Name must be at least 3 characters</span>
              <span *ngIf="nameControl?.errors?.['maxlength']">Name cannot exceed 100 characters</span>
            </div>
          </div>
        </div>

        <!-- Phone -->
        <div class="form-row">
          <div class="form-group">
            <label for="phone">Phone Number <span class="required">*</span></label>
            <input
              type="tel"
              id="phone"
              formControlName="phone"
              placeholder="Enter phone number"
              [ngClass]="{'is-invalid': phoneControl?.invalid && phoneControl?.touched}"
            >
            <div class="error-message" *ngIf="phoneControl?.invalid && phoneControl?.touched">
              <span *ngIf="phoneControl?.errors?.['required']">Phone number is required</span>
              <span *ngIf="phoneControl?.errors?.['minlength']">Phone must be 11 digit</span>
              <span *ngIf="phoneControl?.errors?.['maxlength']">Phone must be 11 digit</span>
              <span *ngIf="phoneControl?.errors?.['pattern']">Enter a valid phone number</span>
            </div>
          </div>
        </div>

        <!-- Email and Password -->
        <div class="form-row two-columns">
          <div class="form-group">
            <label for="email">Email <span class="required">*</span></label>
            <input
              type="email"
              id="email"
              formControlName="email"
              placeholder="Enter email address"
              [ngClass]="{'is-invalid': emailControl?.invalid && emailControl?.touched}"
            >
            <div class="error-message" *ngIf="emailControl?.invalid && emailControl?.touched">
              <span *ngIf="emailControl?.errors?.['required']">Email is required</span>
              <span *ngIf="emailControl?.errors?.['email']">Enter a valid email address</span>
            </div>
          </div>

          <div class="form-group">
            <label for="password">Password <span class="optional">(optional)</span></label>
            <div class="password-input">
              <input
                [type]="hidePassword ? 'password' : 'text'"
                id="password"
                formControlName="password"
                placeholder="keep current password"
                [ngClass]="{'is-invalid': passwordControl?.invalid && passwordControl?.touched}"
              >
              <button type="button" class="password-toggle" (click)="togglePasswordVisibility()">
                <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
            </div>
            <div class="error-message" *ngIf="passwordControl?.invalid && passwordControl?.touched">
              <span *ngIf="passwordControl?.errors?.['minlength']">Password must be at least 8 characters</span>
            </div>
          </div>
        </div>

        <!-- Address -->
        <div class="form-row">
          <div class="form-group">
            <label for="address">Address <span class="required">*</span></label>
            <input
            type="text"
            id="address"
            formControlName="address"
            placeholder="Enter address"
            rows="3"
            [ngClass]="{'is-invalid': addressControl?.invalid && addressControl?.touched}"
          >
            <div class="error-message" *ngIf="addressControl?.invalid && addressControl?.touched">
              <span *ngIf="addressControl?.errors?.['required']">Address is required</span>
              <span *ngIf="addressControl?.errors?.['minlength']">Address must be at least 5 characters</span>
            </div>
          </div>
        </div>

        <!-- Branch and Role -->
        <div class="form-row two-columns">
          <div class="form-group">
            <label for="branch">Branch <span class="required">*</span></label>
            <select
              id="branch"
              formControlName="branchId"
              [ngClass]="{'is-invalid': branchIdControl?.invalid && branchIdControl?.touched, 'has-placeholder': !branchIdControl?.value}"
            >
              <option value="" disabled selected hidden>Select Branch</option>
              <option *ngFor="let branch of branches" [value]="branch.id">{{ branch.name }}</option>
            </select>
            <div class="error-message" *ngIf="branchIdControl?.invalid && branchIdControl?.touched">
              <span *ngIf="branchIdControl?.errors?.['required']">Branch is required</span>
            </div>
          </div>

          <div class="form-group">
            <label for="role">Role <span class="required">*</span></label>
            <select
              id="role"
              formControlName="roleId"
              [ngClass]="{'is-invalid': roleIdControl?.invalid && roleIdControl?.touched, 'has-placeholder': !roleIdControl?.value}"
            >
              <option value="" disabled selected hidden>Select Role</option>
              <option *ngFor="let role of roles" [value]="role.id">{{ role.name }}</option>
            </select>
            <div class="error-message" *ngIf="roleIdControl?.invalid && roleIdControl?.touched">
              <span *ngIf="roleIdControl?.errors?.['required']">Role is required</span>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="btn btn-outline" (click)="goBack()">
            <mat-icon>arrow_back</mat-icon>
            <span>Back</span>
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="loading">
            <div class="spinner" *ngIf="loading"></div>
            <span *ngIf="!loading">
              <mat-icon>save</mat-icon>
              <span>Save Changes</span>
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

