<div class="delivery-container">
    <div class="delivery-header">
      <h1>
        <i class="icon-delivery"></i>
        Delivery Management
      </h1>
    </div>
  
    <div class="delivery-content">
      <div class="delivery-form-card">
        <div class="card-header">
          <h2>
            <i class="icon-info-circle"></i>
            {{ isEditing ? 'Edit Delivery' : 'New Delivery' }}
          </h2>
          <button *ngIf="isEditing" class="btn-close" (click)="cancel()">
            <i class="icon-close"></i>
          </button>
        </div>
  
        <div class="card-body">
          <form [formGroup]="deliveryForm" (ngSubmit)="onSubmit()">
            <div class="form-group">
              <label for="userId">User</label>
              <select 
                id="userId" 
                formControlName="userId" 
                class="form-control"
                [class.is-invalid]="deliveryForm.get('userId')?.invalid && deliveryForm.get('userId')?.touched">
                <option value="">Select User</option>
                <option *ngFor="let user of users" [value]="user.id">{{ user.username }}</option>
              </select>
              <div class="invalid-feedback" *ngIf="deliveryForm.get('userId')?.invalid && deliveryForm.get('userId')?.touched">
                User is required
              </div>
            </div>
  
            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="name">Name</label>
                <input 
                  type="text" 
                  id="name" 
                  formControlName="name" 
                  class="form-control"
                  placeholder="Enter delivery name"
                  [class.is-invalid]="deliveryForm.get('name')?.invalid && deliveryForm.get('name')?.touched">
                <div class="invalid-feedback" *ngIf="deliveryForm.get('name')?.invalid && deliveryForm.get('name')?.touched">
                  <span *ngIf="deliveryForm.get('name')?.errors?.['required']">Name is required</span>
                  <span *ngIf="deliveryForm.get('name')?.errors?.['minlength']">Name must be at least 3 characters</span>
                </div>
              </div>
  
              <div class="form-group col-md-6">
                <label for="email">Email</label>
                <input 
                  type="email" 
                  id="email" 
                  formControlName="email" 
                  class="form-control"
                  placeholder="Enter email address"
                  [class.is-invalid]="deliveryForm.get('email')?.invalid && deliveryForm.get('email')?.touched">
                <div class="invalid-feedback" *ngIf="deliveryForm.get('email')?.invalid && deliveryForm.get('email')?.touched">
                  <span *ngIf="deliveryForm.get('email')?.errors?.['required']">Email is required</span>
                  <span *ngIf="deliveryForm.get('email')?.errors?.['email']">Please enter a valid email</span>
                </div>
              </div>
            </div>
  
            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="password">Password {{ isEditing ? '(Leave blank to keep current)' : '' }}</label>
                <input 
                  type="password" 
                  id="password" 
                  formControlName="password" 
                  class="form-control"
                  placeholder="Enter password"
                  [class.is-invalid]="deliveryForm.get('password')?.invalid && deliveryForm.get('password')?.touched">
                <div class="invalid-feedback" *ngIf="deliveryForm.get('password')?.invalid && deliveryForm.get('password')?.touched">
                  <span *ngIf="deliveryForm.get('password')?.errors?.['required']">Password is required</span>
                  <span *ngIf="deliveryForm.get('password')?.errors?.['minlength']">Password must be at least 6 characters</span>
                </div>
              </div>
  
              <div class="form-group col-md-6">
                <label for="branch">Branch</label>
                <input 
                  type="text" 
                  id="branch" 
                  formControlName="branch" 
                  class="form-control"
                  placeholder="Enter branch name"
                  [class.is-invalid]="deliveryForm.get('branch')?.invalid && deliveryForm.get('branch')?.touched">
                <div class="invalid-feedback" *ngIf="deliveryForm.get('branch')?.invalid && deliveryForm.get('branch')?.touched">
                  Branch is required
                </div>
              </div>
            </div>
  
            <div class="form-group">
              <label for="phone">Phone Number</label>
              <input 
                type="tel" 
                id="phone" 
                formControlName="phone" 
                class="form-control"
                placeholder="Enter phone number"
                [class.is-invalid]="deliveryForm.get('phone')?.invalid && deliveryForm.get('phone')?.touched">
              <div class="invalid-feedback" *ngIf="deliveryForm.get('phone')?.invalid && deliveryForm.get('phone')?.touched">
                <span *ngIf="deliveryForm.get('phone')?.errors?.['required']">Phone number is required</span>
                <span *ngIf="deliveryForm.get('phone')?.errors?.['pattern']">Please enter a valid phone number</span>
              </div>
            </div>
  
            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="government">Government</label>
                <select 
                  id="government" 
                  formControlName="government" 
                  class="form-control"
                  [class.is-invalid]="deliveryForm.get('government')?.invalid && deliveryForm.get('government')?.touched">
                  <option value="">Select Government</option>
                  <option *ngFor="let gov of governments" [value]="gov">{{ gov }}</option>
                </select>
                <div class="invalid-feedback" *ngIf="deliveryForm.get('government')?.invalid && deliveryForm.get('government')?.touched">
                  Government is required
                </div>
              </div>
  
              <div class="form-group col-md-6">
                <label for="city">City</label>
                <select 
                  id="city" 
                  formControlName="city" 
                  class="form-control"
                  [class.is-invalid]="deliveryForm.get('city')?.invalid && deliveryForm.get('city')?.touched"
                  [disabled]="!deliveryForm.get('government')?.value">
                  <option value="">Select City</option>
                  <option *ngFor="let city of availableCities" [value]="city">{{ city }}</option>
                </select>
                <div class="invalid-feedback" *ngIf="deliveryForm.get('city')?.invalid && deliveryForm.get('city')?.touched">
                  City is required
                </div>
              </div>
            </div>
  
            <div class="form-group">
              <label for="address">Address</label>
              <textarea 
                id="address" 
                formControlName="address" 
                class="form-control"
                placeholder="Enter detailed address"
                rows="3"
                [class.is-invalid]="deliveryForm.get('address')?.invalid && deliveryForm.get('address')?.touched"></textarea>
              <div class="invalid-feedback" *ngIf="deliveryForm.get('address')?.invalid && deliveryForm.get('address')?.touched">
                Address is required
              </div>
            </div>
  
            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="saleType">Sale Type</label>
                <select 
                  id="saleType" 
                  formControlName="saleType" 
                  class="form-control"
                  [class.is-invalid]="deliveryForm.get('saleType')?.invalid && deliveryForm.get('saleType')?.touched">
                  <option *ngFor="let type of saleTypes" [value]="type">{{ getSaleTypeLabel(type) }}</option>
                </select>
                <div class="invalid-feedback" *ngIf="deliveryForm.get('saleType')?.invalid && deliveryForm.get('saleType')?.touched">
                  Sale Type is required
                </div>
              </div>
  
              <div class="form-group col-md-6">
                <label for="salePresentage">Sale Percentage</label>
                <div class="input-group">
                  <input 
                    type="number" 
                    id="salePresentage" 
                    formControlName="salePresentage" 
                    class="form-control"
                    placeholder="0"
                    [class.is-invalid]="deliveryForm.get('salePresentage')?.invalid && deliveryForm.get('salePresentage')?.touched">
                  <div class="input-group-append">
                    <span class="input-group-text">%</span>
                  </div>
                </div>
                <div class="invalid-feedback" *ngIf="deliveryForm.get('salePresentage')?.invalid && deliveryForm.get('salePresentage')?.touched">
                  <span *ngIf="deliveryForm.get('salePresentage')?.errors?.['required']">Sale Percentage is required</span>
                  <span *ngIf="deliveryForm.get('salePresentage')?.errors?.['min']">Sale Percentage must be at least 0</span>
                  <span *ngIf="deliveryForm.get('salePresentage')?.errors?.['max']">Sale Percentage cannot exceed 100</span>
                </div>
              </div>
            </div>
  
            <div class="form-group">
              <label for="empId">Assigned Employee</label>
              <select 
                id="empId" 
                formControlName="empId" 
                class="form-control"
                [class.is-invalid]="deliveryForm.get('empId')?.invalid && deliveryForm.get('empId')?.touched">
                <option value="">Select Employee</option>
                <option *ngFor="let employee of employees" [value]="employee.id">{{ employee.username }}</option>
              </select>
              <div class="invalid-feedback" *ngIf="deliveryForm.get('empId')?.invalid && deliveryForm.get('empId')?.touched">
                Employee is required
              </div>
            </div>
  
            <div class="form-actions">
              <button type="button" class="btn btn-outline" (click)="cancel()">Cancel</button>
              <button type="submit" class="btn btn-primary" [disabled]="deliveryForm.invalid || isLoading">
                {{ isEditing ? 'Update' : 'Create' }}
              </button>
            </div>
          </form>
        </div>
      </div>
  
      <!-- Delivery List Section -->
      <div class="delivery-list-card">
        <div class="card-header">
          <h2>
            <i class="icon-list"></i>
            Delivery List
          </h2>
          <div class="header-actions">
            <div class="search-box">
              <i class="icon-search"></i>
              <input type="text" placeholder="Search deliveries">
            </div>
            <button class="btn btn-filter">
              <i class="icon-filter"></i>
              Filter
            </button>
          </div>
        </div>
  
        <div class="card-body">
          <table class="delivery-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Branch</th>
                <th>Location</th>
                <th>Sale Type</th>
                <th>Sale %</th>
                <th>Employee</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let delivery of deliveries">
                <td>{{ delivery.name }}</td>
                <td>{{ delivery.email }}</td>
                <td>{{ delivery.branch }}</td>
                <td>{{ delivery.city }}, {{ delivery.government }}</td>
                <td>{{ getSaleTypeLabel(delivery.saleType) }}</td>
                <td>{{ delivery.salePresentage }}%</td>
                <td>{{ getEmployeeName(delivery.empId) }}</td>
                <td class="actions">
                  <button class="btn-icon" (click)="editDelivery(delivery)">
                    <i class="icon-edit"></i>
                  </button>
                  <button class="btn-icon btn-danger" (click)="deleteDelivery(delivery.userId)">
                    <i class="icon-delete"></i>
                  </button>
                </td>
              </tr>
              <tr *ngIf="deliveries.length === 0">
                <td colspan="8" class="text-center">No deliveries found</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  