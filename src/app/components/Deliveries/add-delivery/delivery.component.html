<div class="delivery-container">
  <div class="delivery-header">
    <h1>
      <i class="icon-delivery"></i>
      Delivery Management
    </h1>
  </div>
  <div class="delivery-content">
    <div class="delivery-form-card">
      <div class="card-header">
        <h2>
          <i class="icon-info-circle"></i>
          {{ isEditing() ? "Edit Delivery" : "New Delivery" }}
        </h2>
        <button *ngIf="isEditing()" class="btn-close" (click)="cancel()">
          <i class="icon-close"></i>
        </button>
      </div>

      <div class="card-body">
        <form [formGroup]="deliveryForm" (ngSubmit)="onSubmit()">
          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="name">Name</label>
              <input
                type="text"
                id="name"
                formControlName="name"
                class="form-control"
                placeholder="Enter delivery name"
                [class.is-invalid]="
                  deliveryForm.get('name')?.invalid &&
                  deliveryForm.get('name')?.touched
                "
              />
              <div
                class="invalid-feedback"
                *ngIf="
                  deliveryForm.get('name')?.invalid &&
                  deliveryForm.get('name')?.touched
                "
              >
                <span *ngIf="deliveryForm.get('name')?.errors?.['required']"
                  >Name is required</span
                >
                <span *ngIf="deliveryForm.get('name')?.errors?.['minlength']"
                  >Name must be at least 3 characters</span
                >
              </div>
            </div>

            <div class="form-group col-md-6">
              <label for="email">Email</label>
              <input
                type="email"
                id="email"
                formControlName="email"
                class="form-control"
                placeholder="Enter email address"
                [class.is-invalid]="
                  deliveryForm.get('email')?.invalid &&
                  deliveryForm.get('email')?.touched
                "
              />
              <div
                class="invalid-feedback"
                *ngIf="
                  deliveryForm.get('email')?.invalid &&
                  deliveryForm.get('email')?.touched
                "
              >
                <span *ngIf="deliveryForm.get('email')?.errors?.['required']"
                  >Email is required</span
                >
                <span *ngIf="deliveryForm.get('email')?.errors?.['email']"
                  >Please enter a valid email</span
                >
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="password"
                >Password
                {{ isEditing() ? "(Leave blank to keep current)" : "" }}</label
              >
              <input
                type="password"
                id="password"
                formControlName="password"
                class="form-control"
                placeholder="Enter password"
                [class.is-invalid]="
                  deliveryForm.get('password')?.invalid &&
                  deliveryForm.get('password')?.touched
                "
              />
              <div
                class="invalid-feedback"
                *ngIf="
                  deliveryForm.get('password')?.invalid &&
                  deliveryForm.get('password')?.touched
                "
              >
                <span *ngIf="deliveryForm.get('password')?.errors?.['required']"
                  >Password is required</span
                >
                <span
                  *ngIf="deliveryForm.get('password')?.errors?.['minlength']"
                  >Password must be at least 8 characters</span
                >
                <span *ngIf="deliveryForm.get('password')?.errors?.['pattern']"
                  >Password must contain uppercase, lowercase, number, and
                  special character</span
                >
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="phone">Phone Number</label>
            <input
              type="tel"
              id="phone"
              formControlName="phone"
              class="form-control"
              placeholder="Enter phone number (e.g., +1234567890)"
              [class.is-invalid]="
                deliveryForm.get('phone')?.invalid &&
                deliveryForm.get('phone')?.touched
              "
            />
            <div
              class="invalid-feedback"
              *ngIf="
                deliveryForm.get('phone')?.invalid &&
                deliveryForm.get('phone')?.touched
              "
            >
              <span *ngIf="deliveryForm.get('phone')?.errors?.['required']"
                >Phone number is required</span
              >
              <span *ngIf="deliveryForm.get('phone')?.errors?.['pattern']"
                >Please enter a valid phone number (10-15 digits)</span
              >
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="government">Government</label>
              <select
                id="government"
                formControlName="government"
                class="form-control"
                multiple
                [class.is-invalid]="
                  deliveryForm.get('government')?.invalid &&
                  deliveryForm.get('government')?.touched
                "
              >
                <option value="">Select Government(s)</option>
                @for (gov of governorates(); track gov) {
                <option [value]="gov">{{ gov }}</option>
                }
              </select>
              <div
                class="invalid-feedback"
                *ngIf="
                  deliveryForm.get('government')?.invalid &&
                  deliveryForm.get('government')?.touched
                "
              >
                At least one government is required
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="address">Address</label>
            <textarea
              id="address"
              formControlName="address"
              class="form-control"
              placeholder="Enter detailed address"
              rows="3"
              [class.is-invalid]="
                deliveryForm.get('address')?.invalid &&
                deliveryForm.get('address')?.touched
              "
            ></textarea>
            <div
              class="invalid-feedback"
              *ngIf="
                deliveryForm.get('address')?.invalid &&
                deliveryForm.get('address')?.touched
              "
            >
              Address is required
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="saleType">Sale Type</label>
              <select
                id="saleType"
                formControlName="saleType"
                class="form-control"
                [class.is-invalid]="
                  deliveryForm.get('saleType')?.invalid &&
                  deliveryForm.get('saleType')?.touched
                "
              >
                <option value="">Select Sale Type</option>
                @for (type of saleTypes(); track type) {
                <option [value]="type">{{ getSaleTypeLabel(type) }}</option>
                }
              </select>
              <div
                class="invalid-feedback"
                *ngIf="
                  deliveryForm.get('saleType')?.invalid &&
                  deliveryForm.get('saleType')?.touched
                "
              >
                Sale Type is required
              </div>
            </div>

            <div class="form-group col-md-6">
              <label for="salePresentage">Sale Percentage</label>
              <div class="input-group">
                <input
                  type="number"
                  id="salePresentage"
                  formControlName="salePresentage"
                  class="form-control"
                  placeholder="0"
                  min="0"
                  max="100"
                  [class.is-invalid]="
                    deliveryForm.get('salePresentage')?.invalid &&
                    deliveryForm.get('salePresentage')?.touched
                  "
                />
                <div class="input-group-append">
                  <span class="input-group-text">%</span>
                </div>
              </div>
              <div
                class="invalid-feedback"
                *ngIf="
                  deliveryForm.get('salePresentage')?.invalid &&
                  deliveryForm.get('salePresentage')?.touched
                "
              >
                <span
                  *ngIf="deliveryForm.get('salePresentage')?.errors?.['required']"
                  >Sale Percentage is required</span
                >
                <span
                  *ngIf="deliveryForm.get('salePresentage')?.errors?.['min']"
                  >Sale Percentage must be at least 0</span
                >
                <span
                  *ngIf="deliveryForm.get('salePresentage')?.errors?.['max']"
                  >Sale Percentage cannot exceed 100</span
                >
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-outline" (click)="cancel()">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
