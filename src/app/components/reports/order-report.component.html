<div class="order-report-container">
  <div class="report-header">
    <div class="header-left">
      <div class="header-icon">
        <mat-icon>assignment</mat-icon>
      </div>
      <h2>Order Reports by Status</h2>
    </div>

    <div class="filters-container">
      <mat-form-field appearance="outline">
        <mat-label>Status</mat-label>
        <mat-select
          [value]="selectedStatus()"
          (selectionChange)="selectedStatus.set($event.value)"
        >
          <mat-option [value]="null">All</mat-option>
          <mat-option
            *ngFor="let option of statusOptions()"
            [value]="option.value"
          >
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Date Range</mat-label>
        <mat-date-range-input [rangePicker]="picker">
          <input
            matStartDate
            placeholder="Start date"
            [value]="dateRangeStart()"
            (dateChange)="dateRangeStart.set($event.value)"
          />
          <input
            matEndDate
            placeholder="End date"
            [value]="dateRangeEnd()"
            (dateChange)="dateRangeEnd.set($event.value)"
          />
        </mat-date-range-input>
        <mat-datepicker-toggle
          matIconSuffix
          [for]="picker"
        ></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>
      </mat-form-field>

      <div class="filter-actions">
        <button mat-raised-button color="primary" (click)="applyFilters()">
          Apply Filters
        </button>
        <button mat-stroked-button color="warn" (click)="clearFilters()">
          Clear
        </button>
      </div>
    </div>
  </div>

  <div class="table-controls">
    <mat-form-field appearance="outline" class="search-box">
      <mat-icon matPrefix>search</mat-icon>
      <input
        matInput
        placeholder="Search orders..."
        [ngModel]="searchTerm()"
        (ngModelChange)="searchTerm.set($event); applyFilters()"
      />
    </mat-form-field>
  </div>

  <div class="table-wrapper">
    <table class="order-report-table">
      <thead>
        <tr>
          <th>#</th>
          <th>ID</th>
          <th>Status</th>
          <th>Merchant</th>
          <th>Customer</th>
          <th>Phone</th>
          <th>Governorate</th>
          <th>City</th>
          <th>Order Cost</th>
          <th>Received</th>
          <th>Shipping</th>
          <th>Paid Shipping</th>
          <th>Company Value</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="orders().length === 0 && !isLoading()">
          <td colspan="14" class="no-data">No data available in table</td>
        </tr>
        <tr
          *ngFor="let order of orders(); let i = index"
          [ngClass]="i % 2 === 0 ? 'row-even' : 'row-odd'"
        >
          <td>{{ (currentPage() - 1) * pageSize() + i + 1 }}</td>
          <td>{{ order.id }}</td>
          <td>
            <span class="status-badge" [ngClass]="order.status.toLowerCase()">
              {{ order.status }}
            </span>
          </td>
          <td>{{ order.merchant }}</td>
          <td>{{ order.customer }}</td>
          <td>{{ order.phone }}</td>
          <td>{{ order.governorate }}</td>
          <td>{{ order.city }}</td>
          <td>{{ order.orderCost | currency : "USD" }}</td>
          <td>{{ order.receivedAmount | currency : "USD" }}</td>
          <td>{{ order.shippingCost | currency : "USD" }}</td>
          <td>{{ order.paidShippingValue | currency : "USD" }}</td>
          <td>{{ order.companyValue | currency : "USD" }}</td>
          <td>{{ order.date | date : "medium" }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination" *ngIf="totalCount()">
    <div class="pagination-info">
      Showing {{ displayRange().start }} to {{ displayRange().end }} of
      {{ displayRange().total }} orders
    </div>
    <div class="pagination-controls">
      <mat-form-field appearance="outline" class="page-size-selector">
        <mat-select [value]="pageSize()">
          <mat-option *ngFor="let size of pageSizeOptions()" [value]="size">
            {{ size }} per page
          </mat-option>
        </mat-select>
      </mat-form-field>
      <button
        mat-icon-button
        class="pagination-btn"
        (click)="firstPage()"
        [disabled]="currentPage() === 1"
      >
        <mat-icon>first_page</mat-icon>
      </button>
      <button
        mat-icon-button
        class="pagination-btn"
        (click)="previousPage()"
        [disabled]="currentPage() === 1"
      >
        <mat-icon>chevron_left</mat-icon>
      </button>
      <button
        mat-mini-fab
        class="pagination-page"
        *ngFor="let page of getPageNumbers()"
        [color]="page === currentPage() ? 'primary' : 'basic'"
        (click)="page > 0 ? goToPage(page) : null"
      >
        {{ page > 0 ? page : "..." }}
      </button>
      <button
        mat-icon-button
        class="pagination-btn"
        (click)="nextPage()"
        [disabled]="currentPage() === totalPages()"
      >
        <mat-icon>chevron_right</mat-icon>
      </button>
      <button
        mat-icon-button
        class="pagination-btn"
        (click)="lastPage()"
        [disabled]="currentPage() === totalPages()"
      >
        <mat-icon>last_page</mat-icon>
      </button>
    </div>
  </div>

  <mat-spinner *ngIf="isLoading()" class="spinner"></mat-spinner>
  <div class="error" *ngIf="errorMessage()">{{ errorMessage() }}</div>
</div>
