<div class="modal-overlay" *ngIf="isVisible" (click)="onOverlayClick($event)">
  <div class="modal-container">
    <div class="modal-header">
      <div class="header-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
      </div>
      <h2>Edit Order #{{ orderId }}</h2>
      <button class="close-btn" (click)="onClose()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="modal-body-scrollable">
      <div class="modal-description">
        Update status, representative, payment, and notes for order #{{ orderId }}.
      </div>

      <form [formGroup]="orderForm" (ngSubmit)="onSubmit()">
        <div class="modal-content">
          <div class="form-section">
            <h3>Order Details</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="orderState">Order Status <span class="required">*</span></label>
                <div class="select-wrapper">
                  <select id="orderState" formControlName="orderState">
                    <option value="" disabled>Select status</option>
                    <option *ngFor="let state of orderStates" [value]="state">{{ state }}</option>
                  </select>
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg>
                </div>
                <div class="error-message" *ngIf="orderForm.get('orderState')?.invalid && orderForm.get('orderState')?.touched">
                  Order status is required
                </div>
              </div>

              <div class="form-group">
                <label for="shippigRepresentativeId">Shipping Representative</label>
                <div class="select-wrapper">
                  <select id="shippigRepresentativeId" formControlName="shippigRepresentativeId">
                    <option value="">None</option>
                    <option *ngFor="let rep of representatives" [value]="rep.id">{{ rep.name }}</option>
                  </select>
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg>
                </div>
              </div>

              <div class="form-group">
                <label for="amountReceived">Amount Received <span class="required">*</span></label>
                <input type="number" id="amountReceived" formControlName="amountReceived" placeholder="Enter amount" step="0.01" min="0">
                <div class="error-message" *ngIf="orderForm.get('amountReceived')?.invalid && orderForm.get('amountReceived')?.touched">
                  <span *ngIf="orderForm.get('amountReceived')?.errors?.['required']">Amount is required</span>
                  <span *ngIf="orderForm.get('amountReceived')?.errors?.['min']">Amount cannot be negative</span>
                </div>
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3>Additional Information</h3>
            <div class="form-group full-width">
              <label for="notes">Notes</label>
              <textarea id="notes" formControlName="notes" rows="4" placeholder="Enter any additional notes"></textarea>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="cancel-btn" (click)="onClose()">Cancel</button>
          <button type="submit" class="save-btn" [disabled]="orderForm.invalid">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>
